<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"jiqiren116.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="简单介绍了AOP的概念，并实现了一个AOP入门案例，简单描述了AOP的工作流程。">
<meta property="og:type" content="article">
<meta property="og:title" content="AOP简介、入门和AOP工作流程">
<meta property="og:url" content="http://jiqiren116.github.io/2023/12/12/AOP%E7%AE%80%E4%BB%8B%E3%80%81%E5%85%A5%E9%97%A8%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/index.html">
<meta property="og:site_name" content="robot-x Blog">
<meta property="og:description" content="简单介绍了AOP的概念，并实现了一个AOP入门案例，简单描述了AOP的工作流程。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://jiqiren116.github.io/2023/12/12/AOP%E7%AE%80%E4%BB%8B%E3%80%81%E5%85%A5%E9%97%A8%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/1630143927489.png">
<meta property="og:image" content="http://jiqiren116.github.io/2023/12/12/AOP%E7%AE%80%E4%BB%8B%E3%80%81%E5%85%A5%E9%97%A8%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/1630144353462.png">
<meta property="og:image" content="http://jiqiren116.github.io/2023/12/12/AOP%E7%AE%80%E4%BB%8B%E3%80%81%E5%85%A5%E9%97%A8%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/1630148447689.png">
<meta property="og:image" content="http://jiqiren116.github.io/2023/12/12/AOP%E7%AE%80%E4%BB%8B%E3%80%81%E5%85%A5%E9%97%A8%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/1630152538083.png">
<meta property="article:published_time" content="2023-12-12T13:22:37.000Z">
<meta property="article:modified_time" content="2023-12-12T13:33:53.639Z">
<meta property="article:author" content="robot-x">
<meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://jiqiren116.github.io/2023/12/12/AOP%E7%AE%80%E4%BB%8B%E3%80%81%E5%85%A5%E9%97%A8%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/1630143927489.png">


<link rel="canonical" href="http://jiqiren116.github.io/2023/12/12/AOP%E7%AE%80%E4%BB%8B%E3%80%81%E5%85%A5%E9%97%A8%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://jiqiren116.github.io/2023/12/12/AOP%E7%AE%80%E4%BB%8B%E3%80%81%E5%85%A5%E9%97%A8%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/","path":"2023/12/12/AOP简介、入门和工作流程/","title":"AOP简介、入门和AOP工作流程"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>AOP简介、入门和AOP工作流程 | robot-x Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">robot-x Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>时间线</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-aop%E7%AE%80%E4%BB%8B"><span class="nav-text"> 1. AOP简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-%E4%BB%80%E4%B9%88%E6%98%AFaop"><span class="nav-text"> 1.1 什么是AOP?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-aop%E4%BD%9C%E7%94%A8"><span class="nav-text"> 1.2 AOP作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-aop%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-text"> 1.3 AOP核心概念</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-aop%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="nav-text"> 2. AOP入门案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#21-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-text"> 2.1 需求分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#22-%E6%80%9D%E8%B7%AF%E5%88%86%E6%9E%90"><span class="nav-text"> 2.2 思路分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#23-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="nav-text"> 2.3 环境准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#24-aop%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="nav-text"> 2.4 AOP实现步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A41%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="nav-text"> 步骤1:添加依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A42%E5%AE%9A%E4%B9%89%E6%8E%A5%E5%8F%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="nav-text"> 步骤2:定义接口与实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A43%E5%AE%9A%E4%B9%89%E9%80%9A%E7%9F%A5%E7%B1%BB%E5%92%8C%E9%80%9A%E7%9F%A5"><span class="nav-text"> 步骤3:定义通知类和通知</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A44%E5%AE%9A%E4%B9%89%E5%88%87%E5%85%A5%E7%82%B9"><span class="nav-text"> 步骤4:定义切入点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A45%E5%88%B6%E4%BD%9C%E5%88%87%E9%9D%A2"><span class="nav-text"> 步骤5:制作切面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A46%E5%B0%86%E9%80%9A%E7%9F%A5%E7%B1%BB%E9%85%8D%E7%BB%99%E5%AE%B9%E5%99%A8%E5%B9%B6%E6%A0%87%E8%AF%86%E5%85%B6%E4%B8%BA%E5%88%87%E9%9D%A2%E7%B1%BB"><span class="nav-text"> 步骤6:将通知类配给容器并标识其为切面类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A47%E5%BC%80%E5%90%AF%E6%B3%A8%E8%A7%A3%E6%A0%BC%E5%BC%8Faop%E5%8A%9F%E8%83%BD"><span class="nav-text"> 步骤7:开启注解格式AOP功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A48%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F"><span class="nav-text"> 步骤8:运行程序</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B91enableaspectjautoproxy"><span class="nav-text"> 知识点1：@EnableAspectJAutoProxy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B92aspect"><span class="nav-text"> 知识点2：@Aspect</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B93pointcut"><span class="nav-text"> 知识点3：@Pointcut</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B94before"><span class="nav-text"> 知识点4：@Before</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-aop%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-text"> 3. AOP工作流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#31-aop%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-text"> 3.1 AOP工作流程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B1spring%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8"><span class="nav-text"> 流程1:Spring容器启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B2%E8%AF%BB%E5%8F%96%E6%89%80%E6%9C%89%E5%88%87%E9%9D%A2%E9%85%8D%E7%BD%AE%E4%B8%AD%E7%9A%84%E5%88%87%E5%85%A5%E7%82%B9"><span class="nav-text"> 流程2:读取所有切面配置中的切入点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B3%E5%88%9D%E5%A7%8B%E5%8C%96bean"><span class="nav-text"> 流程3:初始化bean，</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B4%E8%8E%B7%E5%8F%96bean%E6%89%A7%E8%A1%8C%E6%96%B9%E6%B3%95"><span class="nav-text"> 流程4:获取bean执行方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E5%AE%B9%E5%99%A8%E4%B8%AD%E6%98%AF%E5%90%A6%E4%B8%BA%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1"><span class="nav-text"> 验证容器中是否为代理对象</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E6%80%9D%E8%B7%AF"><span class="nav-text"> 验证思路</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A41%E4%BF%AE%E6%94%B9app%E7%B1%BB%E8%8E%B7%E5%8F%96%E7%B1%BB%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="nav-text"> 步骤1:修改App类,获取类的类型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A42%E4%BF%AE%E6%94%B9myadvice%E7%B1%BB%E4%B8%8D%E5%A2%9E%E5%BC%BA"><span class="nav-text"> 步骤2:修改MyAdvice类，不增强</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A43%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F"><span class="nav-text"> 步骤3:运行程序</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A44%E4%BF%AE%E6%94%B9myadvice%E7%B1%BB%E5%A2%9E%E5%BC%BA"><span class="nav-text"> 步骤4:修改MyAdvice类，增强</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A45%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F"><span class="nav-text"> 步骤5:运行程序</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#32-aop%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-text"> 3.2 AOP核心概念</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="robot-x"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">robot-x</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/jiqiren116" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jiqiren116" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1139401422@qq.com" title="E-Mail → mailto:1139401422@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/1139401422" title="QQ → 1139401422" rel="noopener me"><i class="qq fa-fw"></i>QQ</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://jiqiren116.github.io/2023/12/12/AOP%E7%AE%80%E4%BB%8B%E3%80%81%E5%85%A5%E9%97%A8%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="robot-x">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="robot-x Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="AOP简介、入门和AOP工作流程 | robot-x Blog">
      <meta itemprop="description" content="简单介绍了AOP的概念，并实现了一个AOP入门案例，简单描述了AOP的工作流程。">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AOP简介、入门和AOP工作流程
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-12-12 21:22:37 / 修改时间：21:33:53" itemprop="dateCreated datePublished" datetime="2023-12-12T21:22:37+08:00">2023-12-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">简单介绍了AOP的概念，并实现了一个AOP入门案例，简单描述了AOP的工作流程。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="1-aop简介"><a class="markdownIt-Anchor" href="#1-aop简介"></a> 1. AOP简介</h2>
<p>Spring有两个核心的概念，一个是<code>IOC/DI</code>，一个是<code>AOP</code>。</p>
<p>对于AOP:<mark>AOP是在不改原有代码的前提下对其进行增强。</mark></p>
<p>下面主要了解<code>AOP核心概念</code>,<code>AOP作用</code>:</p>
<h3 id="11-什么是aop"><a class="markdownIt-Anchor" href="#11-什么是aop"></a> 1.1 什么是AOP?</h3>
<ul>
<li>AOP(Aspect Oriented Programming)面向切面编程，一种编程范式，指导开发者如何组织程序结构。
<ul>
<li>OOP(Object Oriented Programming)面向对象编程</li>
</ul>
</li>
</ul>
<p>都知道OOP是一种编程思想，那么AOP也是一种编程思想，编程思想主要的内容就是指导程序员该如何编写程序，所以它们两个是不同的<code>编程范式</code>。</p>
<h3 id="12-aop作用"><a class="markdownIt-Anchor" href="#12-aop作用"></a> 1.2 AOP作用</h3>
<ul>
<li>作用:在不惊动原始设计的基础上为其进行功能增强。</li>
</ul>
<p>前面咱们有技术就可以实现这样的功能即<code>代理模式</code>。</p>
<h3 id="13-aop核心概念"><a class="markdownIt-Anchor" href="#13-aop核心概念"></a> 1.3 AOP核心概念</h3>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Fi4y1S7ix?p=31&amp;vd_source=2e36878d9aabdc582c635ef654da6eaa">Spring-AOP简介</a></p>
<p>为了能更好的理解AOP的相关概念，准备了一个环境，整个环境的内容暂时可以不用关注，最主要的类为:<code>BookDaoImpl</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//记录程序当前执行执行（开始时间）</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//业务执行万次</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;<span class="number">10000</span>;i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;book dao save ...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//记录程序当前执行时间（结束时间）</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//计算时间差</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">totalTime</span> <span class="operator">=</span> endTime-startTime;</span><br><span class="line">        <span class="comment">//输出信息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;执行万次消耗时间：&quot;</span> + totalTime + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao update ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao delete ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">select</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao select ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码的内容相信大家都能够读懂，对于<code>save</code>方法中有计算万次执行消耗的时间。</p>
<p>当在App类中从容器中获取bookDao对象后，分别执行其<code>save</code>,<code>delete</code>,<code>update</code>和<code>select</code>方法后会有如下的打印结果:</p>
<p><img src="1630143927489.png" alt="1630143927489" /></p>
<p>这个时候，就应该有些疑问?</p>
<ul>
<li>对于计算万次执行消耗的时间只有save方法有，为什么delete和update方法也会有呢?</li>
<li>delete和update方法有，那什么select方法为什么又没有呢?</li>
</ul>
<p>这个案例中其实就使用了Spring的AOP，在不惊动(改动)原有设计(代码)的前提下，想给谁添加功能就给谁添加。这个也就是Spring的理念：</p>
<ul>
<li>无入侵式/无侵入式</li>
</ul>
<p>说了这么多，Spring到底是如何实现的呢?</p>
<p><img src="1630144353462.png" alt="1630144353462" /></p>
<p>(1)前面一直在强调，Spring的AOP是对一个类的方法在不进行任何修改的前提下实现增强。对于上面的案例中BookServiceImpl中有<code>save</code>,<code>update</code>,<code>delete</code>和<code>select</code>方法,这些方法给起了一个名字叫<mark>连接点</mark></p>
<p>(2)在BookServiceImpl的四个方法中，<code>update</code>和<code>delete</code>只有打印没有计算万次执行消耗时间，但是在运行的时候已经有该功能，那也就是说<code>update</code>和<code>delete</code>方法都已经被增强，所以对于需要增强的方法给起了一个名字叫<mark>切入点</mark></p>
<p>(3)执行BookServiceImpl的update和delete方法的时候都被添加了一个计算万次执行消耗时间的功能，将这个功能抽取到一个方法中，换句话说就是存放共性功能的方法，给起了个名字叫<mark>通知</mark></p>
<p>(4)通知是要增强的内容，会有多个，切入点是需要被增强的方法，也会有多个，那哪个切入点需要添加哪个通知，就需要提前将它们之间的关系描述清楚，那么对于通知和切入点之间的关系描述，给起了个名字叫<mark>切面</mark></p>
<p>(5)通知是一个方法，方法不能独立存在需要被写在一个类中，这个类也给起了个名字叫<mark>通知类</mark></p>
<p>至此AOP中的核心概念就已经介绍完了，总结下:</p>
<ul>
<li>连接点(JoinPoint)：程序执行过程中的任意位置，粒度为执行方法、抛出异常、设置变量等
<ul>
<li>在SpringAOP中，理解为方法的执行</li>
</ul>
</li>
<li>切入点(Pointcut):匹配连接点的式子
<ul>
<li>在SpringAOP中，一个切入点可以描述一个具体方法，也可也匹配多个方法
<ul>
<li>一个具体的方法:如com.itheima.dao包下的BookDao接口中的无形参无返回值的save方法</li>
<li>匹配多个方法:所有的save方法，所有的get开头的方法，所有以Dao结尾的接口中的任意方法，所有带有一个参数的方法</li>
</ul>
</li>
<li>连接点范围要比切入点范围大，是切入点的方法也一定是连接点，但是是连接点的方法就不一定要被增强，所以可能不是切入点。</li>
</ul>
</li>
<li>通知(Advice):在切入点处执行的操作，也就是共性功能
<ul>
<li>在SpringAOP中，功能最终以方法的形式呈现</li>
</ul>
</li>
<li>通知类：定义通知的类</li>
<li>切面(Aspect):描述通知与切入点的对应关系。</li>
</ul>
<h2 id="2-aop入门案例"><a class="markdownIt-Anchor" href="#2-aop入门案例"></a> 2. AOP入门案例</h2>
<h3 id="21-需求分析"><a class="markdownIt-Anchor" href="#21-需求分析"></a> 2.1 需求分析</h3>
<p>案例设定：测算接口执行效率，但是这个案例稍微复杂了点，对其进行简化。</p>
<p>简化设定：在方法执行前输出当前系统时间。</p>
<p>对于SpringAOP的开发有两种方式，XML 和 <mark>注解</mark>。</p>
<p>因为现在注解使用的比较多，所以采用注解完成AOP的开发。</p>
<p>总结需求为:使用SpringAOP的注解方式完成在方法执行的前打印出当前系统时间。</p>
<h3 id="22-思路分析"><a class="markdownIt-Anchor" href="#22-思路分析"></a> 2.2 思路分析</h3>
<p>需求明确后，具体该如何实现，都有哪些步骤，先来分析下:</p>
<blockquote>
<p>1.导入坐标(pom.xml)</p>
<p>2.制作连接点(原始操作，Dao接口与实现类)</p>
<p>3.制作共性功能(通知类与通知)</p>
<p>4.定义切入点</p>
<p>5.绑定切入点与通知关系(切面)</p>
</blockquote>
<h3 id="23-环境准备"><a class="markdownIt-Anchor" href="#23-环境准备"></a> 2.3 环境准备</h3>
<ul>
<li>
<p>创建一个Maven项目</p>
</li>
<li>
<p>pom.xml添加Spring依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>添加BookDao和BookDaoImpl类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao save ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao update ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>创建Spring的配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>编写App运行类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> ctx.getBean(BookDao.class);</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>
<p>运行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1702371348398</span><br><span class="line">book dao save ...</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>最终创建好的项目结构如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">spring_18_aop_quickstart</span><br><span class="line">├── src</span><br><span class="line">│   └── main</span><br><span class="line">│       └── java</span><br><span class="line">│           └── com.itheima</span><br><span class="line">│               ├── config</span><br><span class="line">│               │   └── SpringConfig.java</span><br><span class="line">│               ├── dao</span><br><span class="line">│               │   ├── impl</span><br><span class="line">│               │   │   └── BookDaolmpl.java</span><br><span class="line">│               │   └── BookDao.java</span><br><span class="line">│               └── App.java</span><br><span class="line">└── pom.xml</span><br></pre></td></tr></table></figure>
<p><strong>说明:</strong></p>
<ul>
<li>目前打印save方法的时候，因为方法中有打印系统时间，所以运行的时候是可以看到系统时间</li>
<li>对于update方法来说，就没有该功能</li>
<li>要使用SpringAOP的方式在不改变update方法的前提下让其具有打印系统时间的功能。</li>
</ul>
<h3 id="24-aop实现步骤"><a class="markdownIt-Anchor" href="#24-aop实现步骤"></a> 2.4 AOP实现步骤</h3>
<h4 id="步骤1添加依赖"><a class="markdownIt-Anchor" href="#步骤1添加依赖"></a> 步骤1:添加依赖</h4>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>AspectJ</code>是一个面向切面编程（AOP）的框架，可以在运行时通过织入切面来改变程序的行为。</p>
<ul>
<li>因为之前导入的<code>spring-context</code>依赖中已经包含了<code>spring-aop</code>,所以不需要再单独导入<code>spring-aop</code></li>
<li>导入AspectJ的jar包,AspectJ是AOP思想的一个具体实现，Spring有自己的AOP实现，但是相比于AspectJ来说比较麻烦，所以直接采用Spring整合ApsectJ的方式进行AOP开发。</li>
</ul>
<h4 id="步骤2定义接口与实现类"><a class="markdownIt-Anchor" href="#步骤2定义接口与实现类"></a> 步骤2:定义接口与实现类</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">环境准备的时候，BookDaoImpl已经准备好，不需要做任何修改</span><br></pre></td></tr></table></figure>
<h4 id="步骤3定义通知类和通知"><a class="markdownIt-Anchor" href="#步骤3定义通知类和通知"></a> 步骤3:定义通知类和通知</h4>
<p>通知就是将共性功能抽取出来后形成的方法，共性功能指的就是当前系统时间的打印。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>类名和方法名没有要求，可以任意。</p>
<h4 id="步骤4定义切入点"><a class="markdownIt-Anchor" href="#步骤4定义切入点"></a> 步骤4:定义切入点</h4>
<p>BookDaoImpl中有两个方法，分别是save和update，要增强的是update方法，该如何定义呢?</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>说明:</strong></p>
<ul>
<li>切入点定义依托一个不具有实际意义的方法进行，即无参数、无返回值、方法体无实际逻辑。</li>
<li>execution及后面编写的内容，后面会说。</li>
</ul>
<h4 id="步骤5制作切面"><a class="markdownIt-Anchor" href="#步骤5制作切面"></a> 步骤5:制作切面</h4>
<p>切面是用来描述通知和切入点之间的关系，如何进行关系的绑定?</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>绑定切入点与通知关系，并指定通知添加到原始连接点的具体执行<mark>位置</mark></p>
<p><img src="1630148447689.png" alt="1630148447689" /></p>
<p><strong>说明:</strong>@Before翻译过来是之前，也就是说通知会在切入点方法执行之前执行，除此之前还有其他四种类型，后面会讲。</p>
<h4 id="步骤6将通知类配给容器并标识其为切面类"><a class="markdownIt-Anchor" href="#步骤6将通知类配给容器并标识其为切面类"></a> 步骤6:将通知类配给容器并标识其为切面类</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤7开启注解格式aop功能"><a class="markdownIt-Anchor" href="#步骤7开启注解格式aop功能"></a> 步骤7:开启注解格式AOP功能</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="步骤8运行程序"><a class="markdownIt-Anchor" href="#步骤8运行程序"></a> 步骤8:运行程序</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> ctx.getBean(BookDao.class);</span><br><span class="line">        bookDao.update();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到在执行update方法之前打印了系统时间戳，说明对原始方法进行了增强，AOP编程成功。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1702372550995</span><br><span class="line">book dao update ...</span><br></pre></td></tr></table></figure>
<h3 id="知识点1enableaspectjautoproxy"><a class="markdownIt-Anchor" href="#知识点1enableaspectjautoproxy"></a> 知识点1：@EnableAspectJAutoProxy</h3>
<table>
<thead>
<tr>
<th>名称</th>
<th>@EnableAspectJAutoProxy</th>
</tr>
</thead>
<tbody>
<tr>
<td>类型</td>
<td>配置类注解</td>
</tr>
<tr>
<td>位置</td>
<td>配置类定义上方</td>
</tr>
<tr>
<td>作用</td>
<td>开启注解格式AOP功能</td>
</tr>
</tbody>
</table>
<h3 id="知识点2aspect"><a class="markdownIt-Anchor" href="#知识点2aspect"></a> 知识点2：@Aspect</h3>
<table>
<thead>
<tr>
<th>名称</th>
<th>@Aspect</th>
</tr>
</thead>
<tbody>
<tr>
<td>类型</td>
<td>类注解</td>
</tr>
<tr>
<td>位置</td>
<td>切面类定义上方</td>
</tr>
<tr>
<td>作用</td>
<td>设置当前类为AOP切面类</td>
</tr>
</tbody>
</table>
<h3 id="知识点3pointcut"><a class="markdownIt-Anchor" href="#知识点3pointcut"></a> 知识点3：@Pointcut</h3>
<table>
<thead>
<tr>
<th>名称</th>
<th>@Pointcut</th>
</tr>
</thead>
<tbody>
<tr>
<td>类型</td>
<td>方法注解</td>
</tr>
<tr>
<td>位置</td>
<td>切入点方法定义上方</td>
</tr>
<tr>
<td>作用</td>
<td>设置切入点方法</td>
</tr>
<tr>
<td>属性</td>
<td>value（默认）：切入点表达式</td>
</tr>
</tbody>
</table>
<h3 id="知识点4before"><a class="markdownIt-Anchor" href="#知识点4before"></a> 知识点4：@Before</h3>
<table>
<thead>
<tr>
<th>名称</th>
<th>@Before</th>
</tr>
</thead>
<tbody>
<tr>
<td>类型</td>
<td>方法注解</td>
</tr>
<tr>
<td>位置</td>
<td>通知方法定义上方</td>
</tr>
<tr>
<td>作用</td>
<td>设置当前通知方法与切入点之间的绑定关系，当前通知方法在原始切入点方法前运行</td>
</tr>
</tbody>
</table>
<h2 id="3-aop工作流程"><a class="markdownIt-Anchor" href="#3-aop工作流程"></a> 3. AOP工作流程</h2>
<p>AOP的入门案例已经完成，对于刚才案例的执行过程，就得来分析分析，这一节主要讲解两个知识点:<code>AOP工作流程</code>和<code>AOP核心概念</code>。其中核心概念是对前面核心概念的补充。</p>
<h3 id="31-aop工作流程"><a class="markdownIt-Anchor" href="#31-aop工作流程"></a> 3.1 AOP工作流程</h3>
<p>由于AOP是基于Spring容器管理的bean做的增强，所以整个工作过程需要从Spring加载bean说起:</p>
<h4 id="流程1spring容器启动"><a class="markdownIt-Anchor" href="#流程1spring容器启动"></a> 流程1:Spring容器启动</h4>
<ul>
<li>容器启动就需要去加载bean,哪些类需要被加载呢?</li>
<li>需要被增强的类，如:BookServiceImpl</li>
<li>通知类，如:MyAdvice</li>
<li>注意此时bean对象还没有创建成功</li>
</ul>
<h4 id="流程2读取所有切面配置中的切入点"><a class="markdownIt-Anchor" href="#流程2读取所有切面配置中的切入点"></a> 流程2:读取所有切面配置中的切入点</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@Aspect</span><br><span class="line">public class MyAdvice &#123;</span><br><span class="line">    @Pointcut(&quot;execution(void com.itheima.dao.BookDao.save())&quot;)</span><br><span class="line">    private void ptx()&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    @Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span><br><span class="line">    private void pt()&#123;&#125;</span><br><span class="line"></span><br><span class="line">    @Before(&quot;pt()&quot;)</span><br><span class="line">    public void method()&#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>上面这个例子中有两个切入点的配置，但是第一个<code>ptx()</code>并没有被使用，所以不会被读取。</li>
</ul>
<h4 id="流程3初始化bean"><a class="markdownIt-Anchor" href="#流程3初始化bean"></a> 流程3:初始化bean，</h4>
<p>判定bean对应的类中的方法是否匹配到任意切入点</p>
<ul>
<li>
<p>注意第1步在容器启动的时候，bean对象还没有被创建成功。</p>
</li>
<li>
<p>要被实例化bean对象的类中的方法和切入点进行匹配</p>
<p><img src="1630152538083.png" alt="1630152538083" /></p>
<ul>
<li>匹配失败，创建原始对象,如<code>UserDao</code>
<ul>
<li>匹配失败说明不需要增强，直接调用原始对象的方法即可。</li>
</ul>
</li>
<li>匹配成功，创建原始对象（<mark>目标对象</mark>）的<mark>代理</mark>对象,如:<code>BookDao</code>
<ul>
<li>匹配成功说明需要对其进行增强</li>
<li>对哪个类做增强，这个类对应的对象就叫做目标对象</li>
<li>因为要对目标对象进行功能增强，而采用的技术是动态代理，所以会为其创建一个代理对象</li>
<li>最终运行的是代理对象的方法，在该方法中会对原始方法进行功能增强</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="流程4获取bean执行方法"><a class="markdownIt-Anchor" href="#流程4获取bean执行方法"></a> 流程4:获取bean执行方法</h4>
<ul>
<li>获取的bean是原始对象时，调用方法并执行，完成操作</li>
<li>获取的bean是代理对象时，根据代理对象的运行模式运行原始方法与增强的内容，完成操作</li>
</ul>
<h4 id="验证容器中是否为代理对象"><a class="markdownIt-Anchor" href="#验证容器中是否为代理对象"></a> 验证容器中是否为代理对象</h4>
<p>为了验证IOC容器中创建的对象和刚才所说的结论是否一致，首先先把结论理出来:</p>
<ul>
<li>如果目标对象中的方法会被增强，那么容器中将存入的是目标对象的代理对象</li>
<li>如果目标对象中的方法不被增强，那么容器中将存入的是目标对象本身。</li>
</ul>
<h5 id="验证思路"><a class="markdownIt-Anchor" href="#验证思路"></a> 验证思路</h5>
<blockquote>
<p>1.要执行的方法，不被定义的切入点包含，即不要增强，打印当前类的getClass()方法</p>
<p>2.要执行的方法，被定义的切入点包含，即要增强，打印出当前类的getClass()方法</p>
<p>3.观察两次打印的结果</p>
</blockquote>
<h5 id="步骤1修改app类获取类的类型"><a class="markdownIt-Anchor" href="#步骤1修改app类获取类的类型"></a> 步骤1:修改App类,获取类的类型</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> ctx.getBean(BookDao.class);</span><br><span class="line">        System.out.println(bookDao);</span><br><span class="line">        System.out.println(bookDao.getClass());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.itheima.dao.impl.BookDaoImpl@47caedad</span><br><span class="line">class jdk.proxy2.$Proxy20</span><br></pre></td></tr></table></figure>
<h5 id="步骤2修改myadvice类不增强"><a class="markdownIt-Anchor" href="#步骤2修改myadvice类不增强"></a> 步骤2:修改MyAdvice类，不增强</h5>
<p>因为定义的切入点中，被修改成<code>update1</code>,所以BookDao中的update方法在执行的时候，就不会被增强，</p>
<p>所以容器中的对象应该是目标对象本身。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update1())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="步骤3运行程序"><a class="markdownIt-Anchor" href="#步骤3运行程序"></a> 步骤3:运行程序</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.itheima.dao.impl.BookDaoImpl@4bdeaabb</span><br><span class="line">class com.itheima.dao.impl.BookDaoImpl</span><br></pre></td></tr></table></figure>
<h5 id="步骤4修改myadvice类增强"><a class="markdownIt-Anchor" href="#步骤4修改myadvice类增强"></a> 步骤4:修改MyAdvice类，增强</h5>
<p>因为定义的切入点中，被修改成<code>update</code>,所以BookDao中的update方法在执行的时候，就会被增强，</p>
<p>所以容器中的对象应该是目标对象的代理对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="步骤5运行程序"><a class="markdownIt-Anchor" href="#步骤5运行程序"></a> 步骤5:运行程序</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.itheima.dao.impl.BookDaoImpl@47caedad</span><br><span class="line">class jdk.proxy2.$Proxy20</span><br></pre></td></tr></table></figure>
<p>至此对于刚才的结论，就得到了验证，这块大家需要注意的是:</p>
<p>不能直接打印对象，从上面两次结果中可以看出，直接打印对象走的是对象的toString方法，不管是不是代理对象打印的结果都是一样的，原因是内部对toString方法进行了重写。</p>
<h3 id="32-aop核心概念"><a class="markdownIt-Anchor" href="#32-aop核心概念"></a> 3.2 AOP核心概念</h3>
<p>在上面介绍AOP的工作流程中，提到了两个核心概念，分别是:</p>
<ul>
<li>目标对象(Target)：原始功能去掉共性功能对应的类产生的对象，这种对象是无法直接完成最终工作的。它是经过剥离了共性功能后的原始对象，但它本身无法直接完成最终工作，需要经过处理才能完成特定的任务。</li>
<li>代理(Proxy)：目标对象无法直接完成工作，需要对其进行功能回填，通过原始对象的代理对象实现</li>
</ul>
<p>上面这两个概念比较抽象，简单来说，</p>
<p>目标对象就是要增强的类[如:BookServiceImpl类]对应的对象，也叫原始对象，不能说它不能运行，只能说它在运行的过程中对于要增强的内容是缺失的。</p>
<p>SpringAOP是在不改变原有设计(代码)的前提下对其进行增强的，它的底层采用的是代理模式实现的，所以要对原始对象进行增强，就需要对原始对象创建代理对象，在代理对象中的方法把通知[如:MyAdvice中的method方法]内容加进去，就实现了增强,这就是所说的代理(Proxy)。</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>robot-x
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://jiqiren116.github.io/2023/12/12/AOP%E7%AE%80%E4%BB%8B%E3%80%81%E5%85%A5%E9%97%A8%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/" title="AOP简介、入门和AOP工作流程">http://jiqiren116.github.io/2023/12/12/AOP简介、入门和工作流程/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Spring/" rel="tag"># Spring</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/12/11/IOC-DI%EF%BC%9A%E7%AC%AC%E4%B8%89%E6%96%B9bean%E7%9A%84%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E3%80%81%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91%E5%92%8C%E6%95%B4%E5%90%88%E5%BC%80%E5%8F%91/" rel="prev" title="IOC/DI：第三方bean的配置管理、注解开发和整合开发">
                  <i class="fa fa-angle-left"></i> IOC/DI：第三方bean的配置管理、注解开发和整合开发
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">robot-x</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/jiqiren116" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.5.0/mermaid.min.js","integrity":"sha256-K7oJiQlDulzl24ZUFOywuYme1JqBBvQzK6m8qHjt9Gk="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
